<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register - Stock Price Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-gray-100 flex items-center justify-center">
    <div class="w-full max-w-md bg-white rounded-lg shadow p-6">
      <h1 class="text-xl font-semibold mb-4">Register</h1>
      <form id="registerForm" class="space-y-4">
        <div>
          <label class="block text-sm text-gray-700 mb-1">Email</label>
          <input type="email" name="email" class="w-full border rounded px-3 py-2" required />
        </div>
        <div>
          <label class="block text-sm text-gray-700 mb-1">Password</label>
          <input type="password" name="password" class="w-full border rounded px-3 py-2" required />
        </div>
        <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Create account</button>
      </form>
      <p class="text-sm text-gray-600 mt-4">
        Already have an account?
        <a class="text-blue-600 hover:underline" href="/login.html">Login</a>
      </p>
      <p id="error" class="text-sm text-red-600 mt-2 hidden"></p>
    </div>
    <script src="/env.js"></script>
    <script>
      const API_BASE = typeof window !== 'undefined' && window.API_BASE_URL ? window.API_BASE_URL : '';
      const form = document.getElementById('registerForm');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(form);
        const payload = { email: fd.get('email'), password: fd.get('password') };
        const res = await fetch(`${API_BASE}/api/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        if (res.ok) {
          location.href = '/dashboard.html';
        } else {
          document.getElementById('error').textContent = data.error || 'Registration failed';
          document.getElementById('error').classList.remove('hidden');
        }
      });
    </script>
  </body>
</html>
