<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register - Stock Price Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: 'class' };
    </script>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center text-slate-800 dark:text-slate-100">
    <div class="w-full max-w-md bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow p-6">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-semibold">Register</h1>
        <button id="themeToggle" class="inline-flex items-center rounded-md border border-slate-300 dark:border-slate-700 px-3 py-1 text-sm hover:bg-slate-100 dark:hover:bg-slate-800">Theme</button>
      </div>
      <form id="registerForm" class="space-y-4">
        <div>
          <label class="block text-sm mb-1">Email</label>
          <input type="email" name="email" class="w-full border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary" required />
        </div>
        <div>
          <label class="block text-sm mb-1">Password</label>
          <input type="password" name="password" class="w-full border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary" required />
        </div>
        <button class="w-full bg-primary text-white py-2 rounded hover:bg-blue-700">Create account</button>
      </form>
      <p class="text-sm text-slate-600 dark:text-slate-300 mt-4">
        Already have an account?
        <a class="text-blue-600 hover:underline" href="/login.html">Login</a>
      </p>
      <p id="error" class="text-sm text-red-600 mt-2 hidden"></p>
    </div>
    <script src="/env.js"></script>
    <script>
      const API_BASE = typeof window !== 'undefined' && window.API_BASE_URL ? window.API_BASE_URL : '';
      const form = document.getElementById('registerForm');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(form);
        const payload = { email: fd.get('email'), password: fd.get('password') };
        const res = await fetch(`${API_BASE}/api/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        if (res.ok) {
          location.href = '/dashboard.html';
        } else {
          document.getElementById('error').textContent = data.error || 'Registration failed';
          document.getElementById('error').classList.remove('hidden');
        }
      });
      const root = document.documentElement;
      const stored = localStorage.getItem('theme');
      if (stored === 'dark') root.classList.add('dark');
      document.getElementById('themeToggle').addEventListener('click', () => {
        root.classList.toggle('dark');
        localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
      });
    </script>
  </body>
</html>
